!function(n,t){"function"==typeof define&&define.amd?define(["angular"],function(n){return t(n)}):"object"==typeof module&&module.exports?module.exports=t(require("angular"),require("angular-jwt"),require("angular-ui-router"),require("ngstorage")):t(n.angular)}(this,function(n){!function(){"use strict";var t=null;n.module("ngAA",["ngStorage","angular-jwt","ui.router"]).config(["$httpProvider","$stateProvider","jwtInterceptorProvider","ngAAConfig",function(n,e,i,r){t=e,i.authHeader=r.authHeader,i.tokenGetter=["ngAAToken",function(n){var t=n.getToken();return t||null}],n.interceptors.push("jwtInterceptor")}]).run(["$rootScope","$state","ngAAConfig","$auth",function(n,e,i,r){t.state(i.signinState,{url:i.signinRoute,templateUrl:i.signinTemplateUrl,controller:"ngAAAuthCtrl"}),n.$on("$stateChangeStart",r._onStateChange),n.$on("unauthenticated",function(t,r){n.$broadcast("authorizationError",r),e.go(i.signinState)}),n.isAuthenticated=r.isAuthenticatedSync()}])}(),function(){"use strict";n.module("ngAA").constant("ngAAConfig",{afterSigninRedirectTo:"home",afterSignoutRedirectTo:"signin",signinUrl:"/signin",signinState:"signin",signinRoute:"/signin",signinTemplateUrl:"views/signin.html",tokenPrefix:"ngAA",tokenName:"token",profileKey:"user",storage:"localStorage",authHeader:"Authorization"})}(),function(){"use strict";n.module("ngAA").provider("$auth",["ngAAConfig",function(t){var e=this,i=Object.keys(t);n.forEach(i,function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){t[n]=e}})}),e.$get=["ngAAUtils","ngAAToken","ngAAUser","ngAAConfig","$rootScope","$state",function(n,t,e,i,r,o){var s={};return s.signin=function(n){return e.signin(n)},s.signout=function(){return e.signout()},s.isAuthenticated=function(){return e.isAuthenticated()},s.isAuthenticatedSync=function(){return e.isAuthenticatedSync()},s.getClaim=function(){return t.getClaim()},s.getProfile=function(){return e.getProfile()},s.hasPermission=function(n){return e.hasPermission(n)},s.hasPermissions=function(n){return e.hasPermissions(n)},s.hasAnyPermission=function(n){return e.hasAnyPermission(n)},s._onStateChange=function(t,s,u,a,c){var f=n.getStatePermits(s),g=s.data?s.data.authenticated:void 0,A=f&&s.name!==i.signinState;if(g&&!A)t.preventDefault(),e.isAuthenticated().then(function(n){n?(r.$broadcast("authenticationAccepted",s,u),o.go(s.name,u,{notify:!1}).then(function(){r.$broadcast("$stateChangeSuccess",s,u,a,c)})):(r.$broadcast("authenticationDenied","Not authenticated"),o.go(i.signinState))});else{if(!A)return;t.preventDefault(),e.isAuthenticated().then(function(n){n?e.checkPermits(f).then(function(n){n?(r.$broadcast("permissionAccepted",s,u),o.go(s.name,u,{notify:!1}).then(function(){r.$broadcast("$stateChangeSuccess",s,u,a,c)})):(r.$broadcast("permissionDenied","Not permitted"),o.go(i.signinState))}):(r.$broadcast("permissionDenied","Not authenticated"),o.go(i.signinState))})}},s}]}])}(),function(){"use strict";n.module("ngAA").factory("ngAAToken",["$localStorage","$sessionStorage","jwtHelper","ngAAConfig",function(n,t,e,i){var r={};return r.getProfileStorageKey=function(){return r.getName()+"_"+i.profileKey},r.getName=function(){return i.tokenPrefix?i.tokenPrefix+"_"+i.tokenName:i.tokenName},r.getStorage=function(){return"localStorage"===i.storage?n:t},r.setToken=function(n){var t=r.getName(),e=n.data[i.tokenName];if(!e)throw new Error("Unknown response format: "+JSON.stringify(n.data));r.getStorage()[t]=e},r.getToken=function(){return r.getStorage()[r.getName()]},r.removeToken=function(){var n=r.getName(),t=r.getProfileStorageKey(),e=r.getStorage();delete e[n],delete e[t]},r.isTokenExpired=function(){var n=r.getToken();return!n||e.isTokenExpired(n)},r.getClaim=function(){var n=r.getToken();return e.decodeToken(n)},r}])}(),function(){"use strict";n.module("ngAA").factory("ngAAUser",["$q","$http","ngAAToken","ngAAConfig","ngAAUtils",function(n,t,e,i,r){var o={};return o.setProfile=function(n){var t=e.getProfileStorageKey(),r=n.data[i.profileKey];if(!r)throw new Error("Unknown response format: "+JSON.stringify(n.data));e.getStorage()[t]=r},o.getProfile=function(){var t=n.defer(),i=e.getStorage()[e.getProfileStorageKey()];return t.resolve(i),t.promise},o.isAuthenticated=function(){var t=n.defer(),i=e.isTokenExpired();return t.resolve(!i),t.promise},o.isAuthenticatedSync=function(){return!e.isTokenExpired()},o.hasPermission=function(n){return o.getProfile().then(function(t){if(!t)return!1;var e=t.permissions;return!!e&&r.includes(e,n)})},o.hasPermissions=function(n){return o.getProfile().then(function(t){if(!t)return!1;var e=t.permissions;return!!e&&r.includesAll(e,n)})},o.hasAnyPermission=function(n){return o.getProfile().then(function(t){if(!t)return!1;var e=t.permissions;return!!e&&r.includesAny(e,n)})},o.signout=function(){return e.removeToken(),n.when()},o.signin=function(n){return t.post(i.signinUrl,n).then(function(n){return e.setToken(n),o.setProfile(n),n})},o.checkPermits=function(n){var t,e=n.withOnly||void 0,i=n.withAll||void 0,r=n.withAny||void 0;return r&&(t=o.hasAnyPermission(r)),i&&(t=o.hasPermissions(i)),e&&(t=o.hasPermission(e)),t},o}])}(),function(){"use strict";n.module("ngAA").factory("ngAAUtils",function(){var t={};return t.includes=function(n,t){var e=Object(n),i=parseInt(e.length)||0;if(0===i)return!1;var r,o=parseInt(arguments[2])||0;o>=0?r=o:(r=i+o)<0&&(r=0);for(var s;r<i;){if(s=e[r],t===s||t!==t&&s!==s)return!0;r++}return!1},t.includesAll=function(e,i){var r=!0;return n.forEach(i,function(n){r=r&&t.includes(e,n)}),r},t.includesAny=function(e,i){var r=!1;return n.forEach(i,function(n){r=r||t.includes(e,n)}),r},t.getStatePermits=function(n){var t;return n.data&&n.data.permits&&(t=n.data.permits),t},t})}(),function(){"use strict";function t(n,t,e){n[e?"removeClass":"addClass"](t,i,{tempClasses:r})}function e(n){return n?n.split(",").map(function(n){return n.trim()}):[]}var i="ng-hide",r="ng-hide-animate";n.module("ngAA").directive("showIfHasPermit",["$animate","ngAAUser",function(n,e){return{restrict:"A",multiElement:!0,link:function(i,r,o){e.hasPermission(o.showIfHasPermit).then(function(e){t(n,r,e)}).catch(function(){t(n,r,!1)})}}}]),n.module("ngAA").directive("showIfHasPermits",["$animate","ngAAUser",function(n,i){return{restrict:"A",multiElement:!0,link:function(r,o,s){var u=e(s.showIfHasPermits);i.hasPermissions(u).then(function(e){t(n,o,e)}).catch(function(){t(n,o,!1)})}}}]),n.module("ngAA").directive("showIfHasAnyPermit",["$animate","ngAAUser",function(n,i){return{restrict:"A",multiElement:!0,link:function(r,o,s){var u=e(s.showIfHasAnyPermit);i.hasAnyPermission(u).then(function(e){t(n,o,e)}).catch(function(){t(n,o,!1)})}}}])}(),function(){"use strict";n.module("ngAA").directive("signout",["$rootScope","$state","ngAAUser","ngAAConfig",function(n,t,e,i){return{restrict:"A",link:function(r,o){function s(r){r.preventDefault(),e.signout().then(function(){n.$broadcast("signoutSuccess"),n.isAuthenticated=e.isAuthenticatedSync(),t.go(i.afterSignoutRedirectTo)}).catch(function(t){n.$broadcast("signoutError",t.message)})}o.on?o.on("click",s):o.bind("click",s)}}}])}(),function(){"use strict";n.module("ngAA").controller("ngAAAuthCtrl",["$rootScope","$scope","ngAAUser","ngAAConfig","$state",function(n,t,e,i,r){t.user={},t.signin=function(){n.$broadcast("signinBegin"),e.signin(t.user).then(function(o){t.user={},n.$broadcast("signinSuccess",o),n.isAuthenticated=e.isAuthenticatedSync(),r.go(i.afterSigninRedirectTo)}).catch(function(e){t.signinError=e,n.$broadcast("signinError",e)})}}])}()});